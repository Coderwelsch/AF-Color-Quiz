function loadTemplates($,e){console.log("Handlebars loaded"),window.$=window.$||$,window.Handlebars=window.Handlebars||e,require(["templates","min/jquery-ui.min"],additionalScriptsLoaded)}function additionalScriptsLoaded(e){templates=e,init()}function initPreloader(){preloader.$preloader=getTemplate("preloader",{}).appendTo($body),loadColorData()}function loadColorData(){$.getJSON("files/json/colors.json",function(e){colorData=e.shuffle(),setTimeout(removePreloader,2e3)})}function preloaded(){removePreloader()}function removePreloader(){preloader.$preloader.addClass("fade-out"),setTimeout(function(){preloader.$preloader.remove(),initGameInterfaceView()},800)}function initGameInterfaceView(){console.log("Init Game Interface");var e=colorData[currentTileIndex];gameInterface.$game=getTemplate("game-interface",{}).appendTo($body),gameInterface.$gameOverView=gameInterface.$game.find(".game-over-view"),gameInterface.$mainView=gameInterface.$game.find(".main-view"),gameInterface.$timeBoard=gameInterface.$game.find(".time-board .seconds"),gameInterface.$scoreBoard=gameInterface.$mainView.find(".score-board"),gameInterface.$scoreBoardValue=gameInterface.$mainView.find(".value"),gameInterface.$mainTiles=gameInterface.$mainView.find(".big-tiles-container").addClass("disabled"),gameInterface.$mainTileFirst=gameInterface.$mainTiles.find(".first-color"),gameInterface.$mainTileSecond=gameInterface.$mainTiles.find(".second-color"),gameInterface.$tilesView=gameInterface.$game.find(".tiles-view"),gameInterface.$chooseView=gameInterface.$game.find(".choose-view"),gameInterface.$game.find(".btn.play").addClass("active"),gameInterface.$game.find(".btn.reload").addClass("disabled"),generateTilesInInputQeue()}function startNewGame(){console.log("Start a new game"),resetGame(),gameInterface.$mainTiles.removeClass("disabled"),gameInterface.$game.find(".btn.play").removeClass("active").addClass("disabled"),gameInterface.$game.find(".btn.reload").addClass("active").removeClass("disabled"),continueWithTileAtIndex(currentTileIndex),playInterval=setInterval(updatePlayTime,1e3)}function updatePlayTime(){currentPlayTime?(currentPlayTime-=1,gameInterface.$timeBoard.text(currentPlayTime)):(clearInterval(playInterval),gameOver())}function gameOver(){var e="";console.log("Game over!"),e=userScore>=1e3?"Hey nicht schlecht! Du hast "+userScore+" Punkte erziehlt!":userScore>=300?"Naja, "+userScore+" Punkte... Da geht doch noch was!":"Wie würde eine Grundschullehrerin sagen: 'Er hat sich stehts bemüht'.<br/><br/>"+userScore+" Punkte.",gameInterface.$gameOverView.addClass("active"),gameInterface.$gameOverView.find(".content").html(e)}function continueWithTileAtIndex(e){var a=gameInterface.$tilesView.find(".tiles-wrapper").first(),t=parseInt(a.attr("data-id")),r=t-1,n=colorData[t],o=colorData[r],i=[colorData[t].name,colorData[r].name],l=getRandomColorValues(i,4),d=getTemplate("choose-btn",l);gameInterface.$mainView.removeClass("win loose"),gameInterface.$mainTiles.find(".label").css({opacity:""}),gameInterface.$mainTiles.find(".tile").removeClass("disabled"),gameInterface.$mainTileFirst.css("background","#"+n.hex).attr("data-accepted-value",n.name),gameInterface.$mainTileSecond.css("background","#"+o.hex).attr("data-accepted-value",o.name),gameInterface.$chooseView.html(d),addDragDropFunctionality()}function addDragDropFunctionality(){gameInterface.$chooseView.find(".choose-btn").draggable({containment:".main-view",revert:"invalid",stop:dragStopped}),gameInterface.$mainTiles.droppable({accept:".choose-btn",drop:bigTilesDropped,activeClass:"active",hoverClass:"hover"})}function dragStopped(){var e=gameInterface.$chooseView.find(".dragged"),a=!1;2===e.length&&(console.log("Dropped two elements. Validate now"),a=validateDroppedElements(),a?(console.log("Win this round"),gameInterface.$mainView.addClass("win"),updateScorePoints(200)):(console.log("Loose this round"),gameInterface.$mainView.addClass("loose"),updateScorePoints(-100,!0)),fadeOutCurrentTiles())}function fadeOutCurrentTiles(){console.log("Fade out tiles"),gameInterface.$mainTiles.find(".label").animate({opacity:0}),setTimeout(function(){gameInterface.$mainTiles.removeClass("disabled"),gameInterface.$tilesView.find(".tiles-wrapper").first().animate({height:0,margin:0,padding:0,opacity:0,border:"1px solid transparent"}),setTimeout(function(){gameInterface.$tilesView.find(".tiles-wrapper").first().remove(),currentTileIndex++,continueWithTileAtIndex(currentTileIndex)},500)},1e3)}function updateScorePoints(e,a){userScore+=e,console.log("New Score: %s",userScore),userScore>=0?(gameInterface.$scoreBoard.addClass("positive").removeClass("negative"),console.log("Scoreboard changed to positive")):(gameInterface.$scoreBoard.addClass("negative").removeClass("positive"),console.log("Scoreboard changed to negative")),scoreIsUpdating||(scoreIsUpdating=!0,scoreBoardUpdateInterval=setInterval(function(){incrementScoreBoardValue(a)},50))}function incrementScoreBoardValue(e){var a=parseInt(gameInterface.$scoreBoardValue.text());e?a>userScore?gameInterface.$scoreBoardValue.text(a-updateScoreChunk):userScore>a?gameInterface.$scoreBoardValue.text(a+updateScoreChunk):(scoreIsUpdating=!1,clearInterval(scoreBoardUpdateInterval)):userScore>a+updateScoreChunk?gameInterface.$scoreBoardValue.text(a+updateScoreChunk):(scoreIsUpdating=!1,clearInterval(scoreBoardUpdateInterval),gameInterface.$scoreBoardValue.text(userScore))}function validateDroppedElements(){var e=gameInterface.$chooseView.find(".dropped-left"),a=gameInterface.$chooseView.find(".dropped-right"),t=gameInterface.$mainTileFirst.attr("data-accepted-value"),r=gameInterface.$mainTileSecond.attr("data-accepted-value"),n=!0;return e.text()===t?console.log("Left dropped item is okay"):(console.log('Left dropped item is wrong. The right is "%s"',t),n=!1),a.text()===r?console.log("Right dropped item is okay"):(console.log('Right dropped item is wrong. The right is "%s"',r),n=!1),n}function bigTilesDropped(e,a){var t=$(a.draggable[0]);targetContainsItem(t)?t.animate({top:"",left:""}):t.draggable("disable").addClass("dragged")}function targetContainsItem(e){var a=e.offset().left+e.width()/2,t=e.offset().top+e.height()/2,r=gameInterface.$mainTiles.offset().left,n=gameInterface.$mainTiles.offset().top,o=r+gameInterface.$mainTiles.width(),i=n+gameInterface.$mainTiles.height(),l=r+gameInterface.$mainTiles.width()/2,d=a>=r&&o>=a,s=t>=n&&i>=t;return d&&s?l>=a?gameInterface.$chooseView.find(".dropped-left").length?(console.log("Item dropped left"),!0):(console.log("Item cant dropped left"),e.addClass("dropped-left"),gameInterface.$mainTiles.find(".first-color").addClass("disabled").find(".label").text(e.text()),!1):gameInterface.$chooseView.find(".dropped-right").length?(console.log("Item dropped right"),!0):(console.log("Item cant dropped right"),e.addClass("dropped-right"),gameInterface.$mainTiles.find(".second-color").addClass("disabled").find(".label").text(e.text()),!1):!1}function getRandomColorValues(e,a){for(var t=[],r=0;r<a-e.length;r++){var n=!1,o;do o=colorData[Math.floor(Math.random()*colorData.length)].name,n=t.exists(o);while(n);t.push(o)}return t=addUniqueValuesAtRandomIndexToArray(t,e)}function addUniqueValuesAtRandomIndexToArray(e,a){for(var t=0;t<a.length;t++){var r=Math.round(Math.random()*e.length);e.insert(r,a[t])}return e}function resetGame(){console.log("Reset game"),gameInterface.$tilesView.empty(),gameInterface.$scoreBoard.removeClass("negative positive"),gameInterface.$scoreBoardValue.text("0000"),gameInterface.$timeBoard.text(playTime),gameInterface.$gameOverView.removeClass("active"),currentTileIndex=0,userScore=0,currentPlayTime=playTime,colorData=colorData.shuffle(),generateTilesInInputQeue(),clearInterval(playInterval)}function generateTilesInInputQeue(){for(var e="",a=0;a<colorData.length;a++)a%2&&a>1&&gameInterface.$tilesView.append(getTemplate("tile",{id:a,"first-color":colorData[a].hex,"second-color":e})),e=colorData[a].hex}function getTemplate(e,a){return $(Handlebars.templates[e](a))}function initVariables(){$body=$("body")}function init(){console.log("Initialize App"),initVariables(),initPreloader(),bindEvents()}function bindEvents(){$body.on("click",".btn.play.active",playBtnClicked),$body.on("click",".btn.reload.active",reloadBtnClicked)}function playBtnClicked(){var e=$(this);e.removeClass("active").addClass("disabled"),startNewGame()}function reloadBtnClicked(){startNewGame()}var templates={},preloader={},gameInterface={},colorData=[],currentTileIndex=0,userScore=0,updateScoreChunk=20,scoreIsUpdating=!1,playTime=60,currentPlayTime=60,playInterval=0,scoreBoardUpdateInterval=0,$body=null;Array.prototype.shuffle=function(){for(var e,a,t=this.length;t;e=Math.floor(Math.random()*t),a=this[--t],this[t]=this[e],this[e]=a);return this},Array.prototype.exists=function(e){for(var a=0;a<this.length;a++)if(this[a]===e)return!0;return!1},Array.prototype.insert=function(e,a){this.splice(e,0,a)},define(["min/jquery-2.1.4.min","handlebars/handlebars.runtime"],loadTemplates);